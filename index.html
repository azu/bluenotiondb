<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>bluenotiondb env generator</title>
    <style>
        .app {
            width: 80%;
            margin: 0 auto;
        }

        /*  fit width */
        input {
            width: 100%;
        }

        textarea {
            width: 100%;
        }

        details {
            margin-top: 1em;
        }
    </style>
</head>
<body>
<div class="app">
    <h1>bluenotiondb env generator</h1>
    <p><a title="azu/bluenotiondb: Sync Bluesky to Notion." href="https://github.com/azu/bluenotiondb">azu/bluenotiondb:
        Sync Bluesky to Notion.</a></p>
    <p>This page does not send any input to servers</p>
    <div>
        <h2>Notion Config</h2>
        <p><b>Required:</b></p>
        <label for="notion_api_key">Notion API key:</label><br>
        <input type="text" id="notion_api_key"
               name="notion_api_key"
               placeholder="secret_xxxx"><br>
        <label for="notion_database_id">Notion Database ID:</label><br>
        <input type="text" id="notion_database_id"
               name="notion_database_id"
               placeholder="xxxxx"><br>
    </div>
    <div>
        <h2>Bluesky Config</h2>
        <p>If you want to sync your Bluesky posts, fill your bluskey account information.</p>
        <label for="bluesky_identifier">Bluesky Identifier:</label><br>
        <input type="text" id="bluesky_identifier"
               name="bluesky_identifier"
               placeholder="xxxxx.bsky.app"><br>
        <label for="bluesky_app_password">BlueSky App password:</label><br>
        <input type="text" id="bluesky_app_password"
               name="bluesky_app_password"
               placeholder="xxx-xxx-xxx"><br>
    </div>
    <div>
        <h2>GitHub Activity Config</h2>
        <p>If you want to sync your GitHub Activity, fill your GitHub account information.</p>
        <label for="github_token___a">GitHub Token:</label><br>
        <input type="text" id="github_token___a"
               name="github_token___a"
               placeholder="ghp-xxxx-xxxx-xxxx"><br>
        <!--  github_user_name -->
        <label for="github_user_name">GitHub User Name:</label><br>
        <input type="text" id="github_user_name"
               name="github_user_name"
               placeholder="GitHub User Name"><br>
    </div>
    <div>
        <h2>GitHub Search Config</h2>
        <p>If you want to sync search results, fill the search query.</p>
        <label for="github_token___b">GitHub Token:</label><br>
        <input type="text" id="github_token___b"
               name="github_token___b"
               placeholder="ghp-xxxx-xxxx-xxxx"><br>
        <!-- select ISSUE or REPOSITORY -->
        <label for="github_search_type">GitHub Search Type:</label><br>
        <select id="github_search_type" name="github_search_type">
            <option value="ISSUE">ISSUE</option>
            <option value="REPOSITORY">REPOSITORY</option>
        </select><br>
        <label for="github_search_query">GitHub Search query:</label><br>
        <input type="text" id="github_search_query"
               name="github_search_query"
               placeholder="GitHub Search query"
               value="involves:@me sort:updated-desc"
        ><br>
        ✍️ <a
            href="https://docs.github.com/en/issues/tracking-your-work-with-issues/filtering-and-searching-issues-and-pull-requests"
            target="_blank" rel="noopener">Search
        Reference</a>
    </div>
    <div>
        <h2>Calendar(iCal)</h2>
        <p>If you want to sync calendar, fill the iCal Url.</p>
        <label for="calendar_url">iCal URL:</label><br>
        <input type="text" id="calendar_url"
               name="calendar_url"
               placeholder="https://example.test/you.ical"><br>
    </div>
    <div>
        <h2>Generated env(click and copy)</h2>
        <textarea id="generated_env" cols="30" rows="10" readonly></textarea>
    </div>
</div>
<script>
    const targetInputSets = [
        // Bluesky
        [
            'notion_database_id',
            'notion_api_key',
            'bluesky_identifier',
            'bluesky_app_password',
        ],
        // GitHub Activity
        [
            'notion_database_id',
            'notion_api_key',
            'github_token___a',
            'github_user_name',
        ],
        // GitHub Search
        [
            'notion_database_id',
            'notion_api_key',
            'github_token___b',
            'github_search_query',
            'github_search_type'
        ],
        // Calendar
        [
            'notion_database_id',
            'notion_api_key',
            'calendar_url',
        ]
    ];

    const generated_env = document.getElementById('generated_env');
    // click to copy
    generated_env.addEventListener('click', () => {
        navigator.clipboard.writeText(generated_env.value).then(() => {
            alert('copied: ' + generated_env.value);
        });
    });
    const onChange = () => {
        const envs = [];
        targetInputSets.forEach((set) => {
            const env = {};
            set.forEach((id) => {
                const input = document.getElementById(id);
                // ___? will be removed from key
                env[id.replace(/___\w+/, "")] = input.value;
            });
            const isFilledEnv = Object.values(env).every((value) => {
                return value.length > 0;
            });
            if (isFilledEnv) {
                envs.push(env);
            }
        })
        generated_env.value = "BLUE_NOTION_ENVS='" + JSON.stringify(envs) + "'"
    }
    const allTargetIds = Array.from(new Set(targetInputSets.flat()));
    allTargetIds.forEach((id) => {
        const input = document.getElementById(id);
        input.addEventListener('input', onChange);
    });
</script>
</body>
</html>
